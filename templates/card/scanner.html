{% extends "base.html" %}
{% block title %}
Ù…Ø§Ø³Ø­ QR Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¶ÙˆØ±
{% endblock %}

{% block content %}
<div class="container my-5" dir="rtl">
    <div class="text-center mb-4">
        <h2 class="fw-bold text-primary">ðŸ“· Ù…Ø§Ø³Ø­ Ø±Ù…Ø² QR Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¶ÙˆØ±</h2>
        <p class="text-muted">ÙŠØ±Ø¬Ù‰ ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¥Ù„Ù‰ Ø§Ù„Ø±Ù…Ø² Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¶ÙˆØ±</p>
    </div>

    <!-- Ù‚Ø§Ø±Ø¦ QR -->
    <div class="d-flex justify-content-center mb-4">
        <div id="reader" class="shadow rounded" style="width: 300px;"></div>
    </div>

    <!-- Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
    <div class="text-center">
        <p id="result" class="text-success fw-bold"></p>

        <!-- Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ -->
        <a href="{{ url_for('card.event_dashboard') }}" class="btn btn-outline-secondary mt-3">
            ðŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        </a>
    </div>
    
</div>

<!-- Ù…ÙƒØªØ¨Ø© QR -->
<script src="https://unpkg.com/html5-qrcode"></script>

<script>
function onScanSuccess(decodedText, decodedResult) {
    document.getElementById('result').innerText = "âœ… Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...";
    window.location.href = decodedText;
    html5QrcodeScanner.clear();
}

function onScanError(errorMessage) {
    console.log("Scan error: ", errorMessage);
}

const html5QrcodeScanner = new Html5QrcodeScanner("reader", {
    fps: 10,
    qrbox: 250
});
html5QrcodeScanner.render(onScanSuccess, onScanError);
</script>
{% endblock %}
